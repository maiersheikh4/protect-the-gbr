<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GBR Species & Observations</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 20px; background: #f0f7fa; color: #03314b;
  }
  h1, h2 {
    color: #016d9f;
  }
  #container {
    max-width: 900px;
    margin: auto;
  }
  .species-list {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background: white;
    border-radius: 6px;
    padding: 10px;
  }
  .species-item {
    padding: 6px 10px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .species-item:hover {
    background-color: #cce7f8;
  }
  .selected {
    background-color: #89c9f8;
    font-weight: bold;
  }
  form label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
  form input, form textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    box-sizing: border-box;
    border-radius: 4px;
    border: 1px solid #bbb;
    transition: border-color 0.2s ease;
  }
  form input:focus, form textarea:focus {
    border-color: #016d9f;
    outline: none;
  }
  button {
    margin-top: 20px;
    background-color: #016d9f;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #014f6c;
  }
  #iucnChartContainer {
    margin-top: 40px;
    background: white;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 0 10px #ccc;
  }
  #message {
    margin-top: 15px;
    font-weight: bold;
    color: green;
  }
  /* Scrollbar for species list */
  .species-list::-webkit-scrollbar {
    width: 8px;
  }
  .species-list::-webkit-scrollbar-thumb {
    background-color: #016d9f;
    border-radius: 4px;
  }
</style>
</head>
<body>

<div id="container">
  <h1>Great Barrier Reef Species Catalogue & Observations</h1>

  <h2>Species Catalogue</h2>
  <p>Select a species to submit an observation.</p>
  <div id="speciesList" class="species-list" aria-label="Species catalogue list" role="listbox" tabindex="0"></div>

  <h2>Submit Your Observation</h2>
  <form id="observationForm" aria-label="Observation submission form">
    <label for="speciesInput">Species (selected from catalogue)</label>
    <input type="text" id="speciesInput" name="species" readonly placeholder="Select a species above" required />

    <label for="dateInput">Date of Observation</label>
    <input type="date" id="dateInput" name="date" required />

    <label for="locationInput">Location (GPS or description)</label>
    <input type="text" id="locationInput" name="location" placeholder="e.g. 18.287° S, 147.699° E" required />

    <label for="notesInput">Additional Notes</label>
    <textarea id="notesInput" name="notes" rows="4" placeholder="Optional extra info"></textarea>

    <button type="submit">Submit Observation</button>
  </form>

  <div id="message" role="alert" aria-live="polite"></div>

  <div id="iucnChartContainer">
    <h2>IUCN Conservation Status of Sample GBR Species</h2>
    <canvas id="iucnChart" aria-label="IUCN Status Chart" role="img"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sample species data including IUCN status (simplified)
  const speciesData = [
    { scientific: "Amphiprion ocellaris", common: "Clownfish", iucn: "Least Concern" },
    { scientific: "Chelonia mydas", common: "Green Sea Turtle", iucn: "Endangered" },
    { scientific: "Galeocerdo cuvier", common: "Tiger Shark", iucn: "Near Threatened" },
    { scientific: "Tridacna gigas", common: "Giant Clam", iucn: "Vulnerable" },
    { scientific: "Bolbometopon muricatum", common: "Bumphead Parrotfish", iucn: "Vulnerable" },
    { scientific: "Carcharodon carcharias", common: "Great White Shark", iucn: "Vulnerable" },
    { scientific: "Pseudocaranx dentex", common: "Silver Trevally", iucn: "Least Concern" }
  ];

  const speciesListEl = document.getElementById('speciesList');
  const speciesInput = document.getElementById('speciesInput');
  const messageEl = document.getElementById('message');

  // Populate species list interactively
  speciesData.forEach((sp, i) => {
    const div = document.createElement('div');
    div.className = 'species-item';
    div.tabIndex = 0;
    div.setAttribute('role', 'option');
    div.innerText = `${sp.scientific} — ${sp.common}`;
    div.dataset.index = i;
    div.addEventListener('click', () => selectSpecies(i));
    div.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        selectSpecies(i);
      }
    });
    speciesListEl.appendChild(div);
  });

  let selectedIndex = null;
  function selectSpecies(index) {
    if (selectedIndex !== null) {
      speciesListEl.children[selectedIndex].classList.remove('selected');
    }
    speciesListEl.children[index].classList.add('selected');
    selectedIndex = index;
    speciesInput.value = speciesData[index].scientific;
    messageEl.innerText = '';
  }

  // Handle observation submission
  document.getElementById('observationForm').addEventListener('submit', e => {
    e.preventDefault();

    if (!speciesInput.value) {
      messageEl.style.color = 'red';
      messageEl.innerText = 'Please select a species from the catalogue above.';
      return;
    }

    // Collect form data
    const observation = {
      species: speciesInput.value,
      date: e.target.date.value,
      location: e.target.location.value.trim(),
      notes: e.target.notes.value.trim()
    };

    // Here: send `observation` to your backend or external API (Google Sheets, Airtable)
    // For now, just show a thank you message
    console.log("Observation submitted:", observation);

    messageEl.style.color = 'green';
    messageEl.innerText = 'Thank you! Your observation has been recorded (locally only).';

    // Reset form except species (keep species selected for multiple entries)
    e.target.reset();
    speciesInput.value = observation.species;
  });

  // IUCN Status chart setup using Chart.js
  const iucnCounts = {
    "Least Concern": 0,
    "Near Threatened": 0,
    "Vulnerable": 0,
    "Endangered": 0,
    "Critically Endangered": 0
  };

  speciesData.forEach(sp => {
    if(iucnCounts.hasOwnProperty(sp.iucn)) iucnCounts[sp.iucn]++;
  });

  const ctx = document.getElementById('iucnChart').getContext('2d');

  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(iucnCounts),
      datasets: [{
        label: 'Number of Species',
        data: Object.values(iucnCounts),
        backgroundColor: [
          '#4caf50', // Least Concern - green
          '#cddc39', // Near Threatened - lime
          '#ff9800', // Vulnerable - orange
          '#f44336', // Endangered - red
          '#b71c1c'  // Critically Endangered - dark red
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'IUCN Conservation Status of Sample GBR Species'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1 }
        }
      }
    }
  });
</script>

</body>
</html>